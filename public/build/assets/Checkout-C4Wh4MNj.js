import{_ as ve,u as fe,E as he,I as _e,r as $,q as ye,g as ge,c as d,a as e,t as s,D as B,n as ae,b,w as be,d as we,v as ke,e as v,F as xe,h as $e,H as Ce,C as E,l as F,j as Te,i as I,f as Pe,S as c,o as p}from"./app-DpBHsqIn.js";const Be={class:"container"},De={class:"checkout-wizard theme-shadow"},je={class:"fw-bold px-5 py-4 border-bottom mb-0"},Ae={class:"row"},Oe={class:"border rounded-3 p-2 p-lg-4 mb-4"},Ie={class:"row"},ze={class:"col-12 col-lg-4"},Ee=["src"],Fe={class:"col-12 col-lg-8"},Me={class:"mt-4 mt-lg-0"},Se={class:"d-flex mt-3 pb-3"},We=["src"],Ne={class:"d-block"},Re={class:"text-muted ms-2"},Ve={class:"text-muted"},He={class:"border rounded-3 p-2 p-lg-4"},qe={class:"mb-4"},Ue={class:"bg-light rounded-3 p-4"},Le={class:"price-breakdown mb-3"},Ge={key:0,class:"d-flex justify-content-between mb-4"},Je={key:1,class:"d-flex justify-content-between mb-4"},Ke={class:"d-flex justify-content-between mb-4 text-danger"},Qe={class:"mb-3"},Xe={type:"submit",class:"btn btn-primary"},Ye={key:3,class:"d-flex justify-content-between mb-3"},Ze={class:"me-3"},et={class:"d-flex justify-content-between flex-wrap"},tt={class:"fw-bold me-1"},ot={class:"fw-bold"},st={key:0,class:"my-3 d-flex justify-content-center"},nt={key:0,class:"col-12 col-lg-4 ps-0 d-flex flex-column pt-3"},at={class:"p-2"},lt={class:"d-flex justify-content-between align-items-center mb-4 px-3"},rt={class:"fw-bold m-0"},it={class:"bg-lightgreen text-success rounded px-2 py-1 text-center"},ct={class:"payment-method-container p-3 rounded",style:{background:"#F1F5F9"}},ut={class:"row row-cols-2 row-cols-md-3 row-cols-lg-2 g-3"},dt=["onClick"],pt=["src"],mt=["checked"],vt={class:"border-top p-4 d-flex align-items-start gap-3"},ft={class:"form-check-label",for:"exampleCheck1"},ht={key:0,class:"mt-auto border-top p-4"},_t={key:1,class:"mt-auto border-top p-4"},yt={disabled:"",class:"btn btn-primary rounded-pill fw-bold w-100"},gt={__name:"Checkout",setup(bt){const l=fe(),D=he(),le=_e(),re=Pe(),j=le.params.id,w=$("stripe"),n=$({}),y=$(0),u=$(0),A=$(!1),C=$(""),O=$(!1);let T=$(!1);ye(()=>y.value,()=>{n.value.is_free?u.value=0:n.value.regular_price&&!n.value.price?u.value=n.value.regular_price-y.value:u.value=n.value.price-y.value});const ie=async()=>{try{const o=await I.get("/coupon/validate",{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`},params:{coupon_code:C.value}});y.value=o.data.data.discount,O.value=!0,c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=c.stopTimer,i.onmouseleave=c.resumeTimer}}).fire({icon:"success",title:"Coupon applied successfully"})}catch{c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=c.stopTimer,i.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"Coupon code is invalid"})}},ce=async()=>{try{const o=await I.get(`/course/show/${j}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`}});n.value=o.data.data.course,n.value.is_free?u.value=0:n.value.regular_price&&!n.value.price?u.value=n.value.regular_price-y.value:u.value=n.value.price-y.value}catch(o){console.error("Error fetching course data:",o)}},ue=()=>{T.value&&w.value?de():c.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=c.stopTimer,t.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"Please select a payment method and agree to the terms and conditions"})},de=async()=>{var o,t,i,m,f,h;if(n.value.is_free?u.value=0:n.value.regular_price&&!n.value.price?u.value=n.value.regular_price-y.value:u.value=n.value.price-y.value,w.value=="stripe"||w.value=="paypal"||w.value=="razorpay"){if(((o=l==null?void 0:l.masterData)==null?void 0:o.currency)!="USD"&&u.value<((t=l==null?void 0:l.masterData)==null?void 0:t.minimum_amount)){c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:a=>{a.onmouseenter=c.stopTimer,a.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:`Please note that a minimum of grand total of ${(i=l==null?void 0:l.masterData)==null?void 0:i.minimum_amount} is required for transaction.`});return}if(((m=l==null?void 0:l.masterData)==null?void 0:m.currency)=="BDT"){c.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:a=>{a.onmouseenter=c.stopTimer,a.onmouseleave=c.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"BDT is not supported at the moment"});return}}try{const r=await I.get(`/enroll/${j}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`},params:{payment_gateway:w.value,coupon_code:C.value,total_amount:u.value}});me(r.data.data.payment_webview_url)}catch(r){c.fire({icon:"error",title:"Oops...",text:((h=(f=r.response)==null?void 0:f.data)==null?void 0:h.message)||"Something went wrong. Please try again."})}},pe=async()=>{var o,t,i,m,f,h;try{const r=await I.get(`/free/enroll/${j}`,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${D.authToken}`}});if(((t=(o=r==null?void 0:r.data)==null?void 0:o.data)==null?void 0:t.status)=="success"){let a=(m=(i=r==null?void 0:r.data)==null?void 0:i.data)==null?void 0:m.status;re.push(`/enroll_status?status=${a}&course_id=${j}`)}}catch(r){c.fire({icon:"error",title:"Oops...",text:((h=(f=r.response)==null?void 0:f.data)==null?void 0:h.message)||"Something went wrong. Please try again."})}};ge(async()=>{await ce(),localStorage.removeItem("handle_course_id")});const me=(o,t=!1)=>{t&&console.log(`Opening payment window: ${o}`);const i=700,m=700,f=screen.width/2-i/2,h=screen.height/2-m/2,r=`resizable,height=${m},width=${i},top=${h},left=${f}`,a=window.open(o,"_blank",r);if(!a){t&&console.error("Failed to open payment window");return}a.document.title="Payment Window Screen - Make Payment";let g=null;const k=x=>{t&&console.log(`Closing with status: ${x}`),a&&!a.closed&&a.close(),window.location.pathname!=="/plan_enroll_status"&&(window.location.href=`/plan_enroll_status?status=${x}`)};g=setInterval(()=>{try{if(a.closed){t&&console.log("Window manually closed"),clearInterval(g),k("closed");return}const x=location.host;if(a.location.host===x){const P=a.location.pathname;P.includes("payment/success")?(clearInterval(g),k("success")):P.includes("payment/cancel")?(clearInterval(g),k("cancel")):(P.includes("payment/fail"),clearInterval(g),k("fail"))}}catch{t&&console.warn("Cross-origin access blocked; cannot track status until redirect returns to same-origin.")}},10),a.focus()};return(o,t)=>{var m,f,h,r,a,g,k,z,x,P,M,S,W,N,R,V,H,q,U,L,G,J,K,Q,X,Y,Z,ee,te,oe,se,ne;const i=Te("router-link");return p(),d("section",Be,[e("section",De,[e("h3",je,s(o.$t("Checkout")),1),e("div",Ae,[e("div",{class:ae((m=n.value)!=null&&m.is_free?"col-12":"col-12 col-lg-8 border-end p-4 ps-4 ps-lg-5")},[e("div",Oe,[e("div",Ie,[e("div",ze,[e("img",{src:(f=n.value)==null?void 0:f.thumbnail,width:"100%",alt:"",height:"140px",class:"object-fit-cover rounded-3"},null,8,Ee)]),e("div",Fe,[e("h5",Me,s((h=n.value)==null?void 0:h.title),1),e("div",Se,[e("img",{src:(a=(r=n.value)==null?void 0:r.instructor)==null?void 0:a.profile_picture,class:"rounded-circle object-fit-cover me-3",height:"30px",width:"30px"},null,8,We),e("div",null,[e("span",Ne,s((k=(g=n.value)==null?void 0:g.instructor)==null?void 0:k.name),1)])]),e("div",null,[t[4]||(t[4]=e("i",{class:"bi bi-star-fill text-warning me-2"},null,-1)),e("strong",null,s((z=n.value)==null?void 0:z.average_rating),1),e("span",Re,"("+s((x=n.value)==null?void 0:x.review_count)+" "+s(o.$t("Reviews"))+")",1),t[5]||(t[5]=e("span",{class:"text-muted mx-1"},[e("i",{class:"bi bi-dot"})],-1)),e("span",Ve,s((P=n.value)==null?void 0:P.student_count)+" "+s(o.$t("Enrolled")),1)])])])]),e("div",He,[e("h5",qe,s(o.$t("Order Details")),1),e("div",Ue,[e("div",Le,[(M=n.value)!=null&&M.price?(p(),d("div",Ge,[e("span",null,s(o.$t("Course Price")),1),e("strong",null,s((W=(S=b(l))==null?void 0:S.masterData)==null?void 0:W.currency_symbol)+s((N=n.value)!=null&&N.is_free?0:(R=n.value)==null?void 0:R.price),1)])):(p(),d("div",Je,[e("span",null,s(o.$t("Course Price")),1),e("strong",null,s((H=(V=b(l))==null?void 0:V.masterData)==null?void 0:H.currency_symbol)+s((q=n.value)!=null&&q.is_free?0:(U=n.value)==null?void 0:U.regular_price),1)])),e("div",Ke,[e("span",null,s(o.$t("Discount")),1),e("strong",null,"-"+s((G=(L=b(l))==null?void 0:L.masterData)==null?void 0:G.currency_symbol)+s(y.value),1)]),e("div",Qe,[A.value?B("",!0):(p(),d("span",{key:0,onClick:t[0]||(t[0]=_=>A.value=!0),class:"text-primary text-decoration-underline cursor-pointer"},s(o.$t("Have any coupon"))+"?",1))]),!O.value&&A.value?(p(),d("form",{key:2,onSubmit:be(ie,["prevent"]),class:"bg-white d-flex rounded-3 p-4 mb-3"},[we(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=_=>C.value=_),class:"form-control me-3",placeholder:"Enter coupon code"},null,512),[[ke,C.value]]),e("button",Xe,s(o.$t("Apply")),1)],32)):B("",!0),O.value?(p(),d("div",Ye,[e("div",null,[t[7]||(t[7]=e("i",{class:"ri-checkbox-circle-fill text-success me-1"},null,-1)),e("span",Ze,s(o.$t("Coupon Applied")),1),e("small",{onClick:t[2]||(t[2]=_=>{O.value=!1,A.value=!0,C.value=null}),class:"text-success bg-lightgreen px-2 py-1 rounded cursor-pointer"},[v(s(C.value)+" ",1),t[6]||(t[6]=e("i",{class:"ri-edit-line"},null,-1))])])])):B("",!0)]),e("div",et,[e("span",null,[e("span",tt,s(o.$t("Subtotal")),1),e("span",null,"("+s(o.$t("Payable"))+")",1)]),e("span",ot,s((K=(J=b(l))==null?void 0:J.masterData)==null?void 0:K.currency_symbol)+s(u.value.toFixed(2)),1)])])]),(Q=n.value)!=null&&Q.is_free?(p(),d("div",st,[e("button",{onClick:pe,class:"d-flex justify-content-center gap-2 btn btn-primary rounded-pill fw-bold w-50"},[...t[8]||(t[8]=[v(" Enroll Now ",-1),e("i",{class:"bi bi-arrow-right float-end"},null,-1)])])])):B("",!0)],2),(X=n.value)!=null&&X.is_free?B("",!0):(p(),d("div",nt,[e("div",at,[e("div",lt,[e("h5",rt,s(o.$t("Payment Method")),1),e("small",it,[t[9]||(t[9]=e("i",{class:"ri-shield-check-fill me-1"},null,-1)),v(" "+s(o.$t("100% Secure Payment")),1)])]),e("div",ct,[e("div",ut,[(p(!0),d(xe,null,$e((Z=(Y=b(l))==null?void 0:Y.masterData)==null?void 0:Z.payment_methods,_=>(p(),d("div",{key:_.id,class:"col"},[e("div",{onClick:wt=>w.value=_.gateway,class:ae(["card","payment-card","d-flex","flex-row","justify-content-between","align-items-center","px-2 py-1",w.value==_.gateway?"selected":""])},[e("img",{src:_.logo,class:"payment-logo",alt:"Payment method logo"},null,8,pt),e("input",{class:"form-check-input",type:"radio",checked:w.value==_.gateway},null,8,mt)],10,dt)]))),128))])])]),e("div",vt,[e("input",{type:"checkbox",class:"form-check-input",id:"exampleCheck1",required:"",onChange:t[3]||(t[3]=_=>Ce(T)?T.value=!b(T):T=!b(T))},null,32),e("label",ft,[v(s(o.$t("By proceeding, you agree to the"))+" ",1),E(i,{to:"/page/terms_and_conditions",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:F(()=>[v(s(o.$t("Terms & Condition")),1)]),_:1}),t[10]||(t[10]=v(",",-1)),E(i,{to:"/page/privacy_policy",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:F(()=>[v(s(o.$t("Privacy Policy")),1)]),_:1}),v(" "+s(o.$t("and"))+" ",1),E(i,{to:"/page/refund_policy",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:F(()=>[v(s(o.$t("Refund Policy")),1)]),_:1}),v(" of "+s((te=(ee=b(l))==null?void 0:ee.masterData)==null?void 0:te.name),1)])]),(oe=n.value)!=null&&oe.is_enrolled?(p(),d("div",_t,[e("button",yt,s(o.$t("Already Enrolled")),1)])):(p(),d("div",ht,[e("button",{onClick:ue,class:"btn btn-primary rounded-pill fw-bold w-100"},[v(s(o.$t("Pay"))+" "+s((ne=(se=b(l))==null?void 0:se.masterData)==null?void 0:ne.currency_symbol)+s(u.value.toFixed(2))+" ",1),t[11]||(t[11]=e("i",{class:"bi bi-arrow-right float-end"},null,-1))])]))]))])])])}}},xt=ve(gt,[["__scopeId","data-v-6c669298"]]);export{xt as default};
