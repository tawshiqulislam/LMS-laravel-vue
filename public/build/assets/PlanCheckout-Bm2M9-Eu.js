import{_ as ee,c as i,a as e,F as T,h as D,L as U,o as r,u as ce,E as de,I as ue,r as k,z as L,q as pe,g as me,A as he,S as m,D as W,C as z,d as X,t as l,N as ve,b as C,e as f,H as fe,l as H,j as ge,i as R,n as Z,O as _e}from"./app-DpBHsqIn.js";const ye={},we={class:"container py-5"},be={class:"row g-4"},ke={class:"col-lg-6"},xe={class:"card shadow-sm rounded-4 p-4"},$e={class:"col-lg-6"},Ce={class:"card shadow-sm rounded-4 p-4"},Pe={class:"list-group mb-3"};function Te(te,c){return r(),i("div",we,[e("div",be,[e("div",ke,[e("div",xe,[c[1]||(c[1]=e("div",{class:"placeholder-glow mb-4"},[e("span",{class:"placeholder col-6",style:{height:"18px"}})],-1)),c[2]||(c[2]=e("div",{class:"placeholder-glow mb-3"},[e("span",{class:"placeholder col-12",style:{height:"10px"}})],-1)),(r(),i(T,null,D(3,n=>e("div",{key:n,class:"card mb-3 shadow-sm border-0 rounded-4"},[...c[0]||(c[0]=[U('<div class="row g-0"><div class="col-md-4"><div class="placeholder-glow w-100 h-100" style="height:120px;background-color:#e0e0e0;"></div></div><div class="col-md-8 p-3"><h5 class="placeholder-glow"><span class="placeholder col-6"></span></h5><p class="placeholder-glow mb-2"><span class="placeholder col-4"></span></p><p class="placeholder-glow"><span class="placeholder col-2"></span></p></div></div>',1)])])),64))])]),e("div",$e,[e("div",Ce,[c[5]||(c[5]=e("div",{class:"placeholder-glow mb-4"},[e("span",{class:"placeholder col-6",style:{height:"18px"}})],-1)),e("ul",Pe,[(r(),i(T,null,D(2,n=>e("li",{key:"right-course-"+n,class:"list-group-item d-flex justify-content-between align-items-center placeholder-glow"},[...c[3]||(c[3]=[e("span",{class:"placeholder col-5"},null,-1),e("span",{class:"placeholder col-2"},null,-1)])])),64)),c[4]||(c[4]=e("li",{class:"list-group-item d-flex justify-content-between align-items-center placeholder-glow"},[e("span",{class:"placeholder col-4"}),e("span",{class:"placeholder col-2"})],-1))]),c[6]||(c[6]=U('<div class="placeholder-glow mb-3"><span class="placeholder col-12" style="height:38px;"></span></div><div class="row"><div class="col-md-6 mb-3"><div class="placeholder-glow"><span class="placeholder col-12" style="height:38px;"></span></div></div><div class="col-md-6 mb-3"><div class="placeholder-glow"><span class="placeholder col-12" style="height:38px;"></span></div></div></div><div class="placeholder-glow"><span class="placeholder col-12" style="height:44px;"></span></div>',3))])])])])}const De=ee(ye,[["render",Te]]),Be={key:0,class:"text-center py-5"},je={key:0,class:"fullpage-skeleton bg-white"},Ie={key:1,class:"container py-3"},Se={class:"row g-4 d-flex align-items-stretch"},Fe={class:"col-lg-6"},Oe={class:"card shadow-sm rounded-4"},Me={class:"card-body"},qe={class:"mb-4 text-primary"},Ne={disabled:"",value:""},We=["value","selected"],Ve={class:"mb-3"},ze={key:0,class:"course-scroll-container p-3 rounded",style:{background:"#F1F5F9"}},Ae={class:"row g-2"},Ee=["onClick"],Le=["src"],He=["onClick"],Re={class:"card-body p-0"},Ue={class:"d-flex justify-content-between"},Ye={class:"card-title mb-1"},Ge=["onClick"],Je=["id","value","disabled"],Ke={class:"card-text text-muted mb-1"},Qe={class:"card-text fw-bold text-primary mt-auto"},Xe={key:0,class:"course-skeletons"},Ze={key:1,class:"alert alert-danger mt-3"},et={class:"col-lg-6"},tt={class:"card shadow-sm rounded-4 mb-3"},st={class:"card-body"},lt={class:"mb-4 text-primary"},ot={key:0,class:"list-group mb-3 shadow-sm"},at=["src"],nt={class:"text-muted"},it={class:"list-group-item d-flex justify-content-between"},rt={class:"text-primary"},ct={class:"list-group-item d-flex justify-content-between"},dt={class:"text-primary"},ut={key:0,class:"list-group-item d-flex justify-content-center"},pt={class:"text-center text-muted"},mt={class:"text-primary"},ht={class:"text-primary"},vt={key:1,class:"text-muted list-group mb-3"},ft={class:"list-group-item d-flex justify-content-between align-items-center"},gt={class:"card shadow-sm rounded-4"},_t={class:"card-body"},yt={class:"d-flex flex-column"},wt={class:"mb-3"},bt={class:"d-flex justify-content-between align-items-center mb-4"},kt={class:"fw-bold"},xt={class:"bg-lightgreen text-success rounded px-2 py-1 text-center"},$t={class:"payment-method-container p-3 rounded",style:{background:"#F1F5F9"}},Ct={class:"row row-cols-2 row-cols-md-3 row-cols-lg-3 g-3"},Pt=["onClick"],Tt=["src"],Dt=["checked"],Bt={class:"border-top p-4 d-flex align-items-start gap-3"},jt={class:"form-check-label",for:"exampleCheck1"},It={class:"mt-auto border-top p-4"},St={__name:"PlanCheckout",setup(te){const c=ue(),n=ce(),se=de();c.query.id;const y=k("paypal");let S=k(!1);const B=k([]),F=k({}),h=k(""),u=k([]),O=k(""),j=k(!0),w=k(0),V=L(()=>u.value.reduce((t,s)=>t+s.price,0).toFixed(2)),Y=L(()=>{var t;return(t=h.value)!=null&&t.price?(V.value-h.value.price).toFixed(2):0}),le=L(()=>V.value?Math.round(Y.value/V.value*100):0),oe=()=>{if(!h.value){O.value="Please select a plan first.";return}S.value&&y.value&&h.value&&u.value.length>0?(console.log(`Selected Plan: ${h.value.title}, Payment Method: ${y.value}`),ne()):u.value.length===0?m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=m.stopTimer,s.onmouseleave=m.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"Please select a course to proceed with payment."}):S.value||m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=m.stopTimer,s.onmouseleave=m.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"Please select a payment method and agree to the terms and conditions"})},ae=async()=>{try{j.value=!0;const t=await R.get("/plan/list");F.value=t.data.data;const s=F.value.find(a=>a.id==c.query.id);s?(h.value=s,await A(s.id)):(h.value=F.value[0],await A(F.value[0].id))}catch(t){console.error(t),O.value="Failed to load course data."}finally{j.value=!1}};pe(h,t=>{t&&t.id&&(u.value=[],A(t.id))});const A=async(t=null)=>{try{j.value=!0;const s=await R.get(`/plan/show/${t}`);B.value=s.data.data.courses||[],w.value=parseInt(s.data.data.course_limit)||0}catch(s){console.error(s),O.value="Failed to load course data."}finally{j.value=!1}},ne=async()=>{var t,s,a,p,v,P;if(y.value=="stripe"||y.value=="paypal"||y.value=="razorpay"){if(((t=n==null?void 0:n.masterData)==null?void 0:t.currency)!="USD"&&h.value.price<((s=n==null?void 0:n.masterData)==null?void 0:s.minimum_amount)){m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:d=>{d.onmouseenter=m.stopTimer,d.onmouseleave=m.resumeTimer}}).fire({icon:"error",title:"Oops...",text:`Please note that a minimum of grand total of ${(a=n==null?void 0:n.masterData)==null?void 0:a.minimum_amount} is required for transaction.`});return}if(((p=n==null?void 0:n.masterData)==null?void 0:p.currency)=="BDT"){m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:1500,timerProgressBar:!0,didOpen:d=>{d.onmouseenter=m.stopTimer,d.onmouseleave=m.resumeTimer}}).fire({icon:"error",title:"Oops...",text:"BDT is not supported at the moment"});return}}try{const _=await R.get("/plan-enroll",{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${se.authToken}`},params:{payment_gateway:y.value,total_amount:h.value.price,plan_id:h.value.id,course_ids:u.value?u.value.map(d=>d.id):[]}});ie(_.data.data.payment_webview_url)}catch(_){m.fire({icon:"error",title:"Oops...",text:((P=(v=_.response)==null?void 0:v.data)==null?void 0:P.message)||"Something went wrong. Please try again."})}},ie=(t,s=!1)=>{s&&console.log(`Opening payment window: ${t}`);const a=700,p=700,v=screen.width/2-a/2,P=screen.height/2-p/2,_=`resizable,height=${p},width=${a},top=${P},left=${v}`,d=window.open(t,"_blank",_);if(!d){s&&console.error("Failed to open payment window");return}d.document.title="Payment Window Screen - Make Payment";let b=null;const x=$=>{s&&console.log(`Closing with status: ${$}`),d&&!d.closed&&d.close(),window.location.pathname!=="/plan_enroll_status"&&(window.location.href=`/plan_enroll_status?status=${$}`)};b=setInterval(()=>{try{if(d.closed){s&&console.log("Window manually closed"),clearInterval(b),x("closed");return}const $=location.host;if(d.location.host===$){const I=d.location.pathname;I.includes("payment/success")?(clearInterval(b),x("success")):I.includes("payment/cancel")?(clearInterval(b),x("cancel")):(I.includes("payment/fail"),clearInterval(b),x("fail"))}}catch{s&&console.warn("Cross-origin access blocked; cannot track status until redirect returns to same-origin.")}},10),d.focus()},M=t=>{const s=document.getElementById(`course-${t.id}`);if(!s)return;const a=s.checked=!s.checked,p=u.value.some(v=>v.id===t.id);a&&!p?u.value.push(t):!a&&p&&(u.value=u.value.filter(v=>v.id!==t.id))};me(async()=>{await ae(),await he();const t=c.query.course_id;if(t){const a=B.value.find(p=>p.id==t);a&&M(a)}const s=c.query.course_ids?c.query.course_ids.split(",").map(a=>parseInt(a.trim())).filter(a=>!isNaN(a)):[];if(s.length>0){const a=B.value.filter(p=>s.includes(p.id));a.length>w.value?m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:v=>{v.onmouseenter=m.stopTimer,v.onmouseleave=m.resumeTimer}}).fire({icon:"error",title:"Oops...",text:`Cannot select ${a.length} courses. The plan allows a maximum of ${w.value} courses.`}):a.forEach(p=>{M(p)})}});function re(t){if(!t)return"";const s=40;return t.length>s?t.slice(0,s)+"...":t}return(t,s)=>{var p,v,P,_,d,b,x,E,$,I,G,J,K,Q;const a=ge("router-link");return j.value?(r(),i("div",Be,[j.value?(r(),i("div",je,[z(De)])):W("",!0)])):(r(),i("div",Ie,[e("div",Se,[e("div",Fe,[e("div",Oe,[e("div",Me,[e("h4",qe,l(t.$t("Select Subscription Plan")),1),X(e("select",{class:"form-select mb-4","onUpdate:modelValue":s[0]||(s[0]=o=>h.value=o)},[e("option",Ne,l(t.$t("Choose Plan")),1),(r(!0),i(T,null,D(F.value,o=>(r(),i("option",{key:o.id,value:o,selected:o.id==t.$route.query.id},l(o.title)+" ("+l(t.$t("Max"))+" "+l(o.course_limit)+" "+l(t.$t("courses"))+") ",9,We))),128))],512),[[ve,h.value]]),e("h4",Ve,l(t.$t("Select Courses")),1),w.value!==null&&B.value.length>0?(r(),i("div",ze,[(r(!0),i(T,null,D(B.value,o=>{var q,N;return r(),i("div",{key:o.id,class:Z(["card mb-3 shadow-sm border-0 rounded-4",w.value!==null&&u.value.length>=w.value&&!u.value.some(g=>g.id===o.id)?"disabled-course":""])},[e("div",Ae,[e("div",{class:"col-12 col-sm-4 col-xl-4 d-flex justify-content-center align-items-center",onClick:g=>M(o)},[e("img",{src:o.thumbnail,class:"rounded-start selectable-course-thumbnail",alt:"Course Thumbnail"},null,8,Le)],8,Ee),e("div",{class:"col-12 col-sm-8 col-xl-8 d-flex flex-column p-3",onClick:g=>M(o)},[e("div",Re,[e("div",Ue,[e("h5",Ye,l(re(o.title)),1),e("div",{class:"form-check ms-2",onClick:g=>M(o)},[X(e("input",{class:"form-check-input",type:"checkbox",id:"course-"+o.id,value:o,disabled:w.value!==null&&u.value.length>=w.value&&!u.value.some(g=>g.id===o.id),"onUpdate:modelValue":s[1]||(s[1]=g=>u.value=g),style:{width:"20px",height:"20px"}},null,8,Je),[[_e,u.value]])],8,Ge)]),e("p",Ke,l(o.instructor.user.name),1)]),e("p",Qe,l((N=(q=C(n))==null?void 0:q.masterData)==null?void 0:N.currency_symbol)+l(o.price?o.price:o.regular_price),1)],8,He)])],2)}),128)),B.value.length===0?(r(),i("div",Xe,[(r(),i(T,null,D(3,o=>e("div",{key:o,class:"card mb-3 shadow-sm border-0 rounded-4"},[...s[3]||(s[3]=[U('<div class="row g-0" data-v-98058185><div class="col-md-4" data-v-98058185><div class="placeholder-glow w-100 h-100" style="height:120px;background-color:#e0e0e0;" data-v-98058185></div></div><div class="col-md-8 p-3" data-v-98058185><h5 class="placeholder-glow" data-v-98058185><span class="placeholder col-6" data-v-98058185></span></h5><p class="placeholder-glow mb-2" data-v-98058185><span class="placeholder col-4" data-v-98058185></span></p><p class="placeholder-glow" data-v-98058185><span class="placeholder col-2" data-v-98058185></span></p></div></div>',1)])])),64))])):W("",!0)])):W("",!0),O.value?(r(),i("div",Ze,l(O.value),1)):W("",!0)])])]),e("div",et,[e("div",tt,[e("div",st,[e("h4",lt,l(t.$t("Payment Details")),1),e("div",null,[u.value.length>0?(r(),i("ul",ot,[(r(!0),i(T,null,D(u.value,(o,q)=>{var N,g;return r(),i("li",{key:o.id,class:"list-group-item d-flex justify-content-between align-items-center"},[e("span",null,[f(" #"+l(q+1)+" ",1),e("img",{src:o.thumbnail,class:"me-1 ms-1 course-thumbnail",alt:"..."},null,8,at),f(" "+l(o.title.slice(0,40)+(o.title.length>40?"...":"")),1)]),e("strong",nt,l((g=(N=C(n))==null?void 0:N.masterData)==null?void 0:g.currency_symbol)+l(o.price?o.price:o.regular_price),1)])}),128)),e("li",it,[e("strong",null,l(t.$t("Total Price Without Plan")),1),e("strong",rt,l((v=(p=C(n))==null?void 0:p.masterData)==null?void 0:v.currency_symbol)+l(V.value),1)]),e("li",ct,[e("strong",null,l(t.$t("Subscription Plan Price")),1),e("strong",dt,l((_=(P=C(n))==null?void 0:P.masterData)==null?void 0:_.currency_symbol)+l((d=h.value)==null?void 0:d.price),1)]),u.value.length>=w.value?(r(),i("li",ut,[e("strong",pt,[f(l(t.$t("You save"))+" ",1),e("span",mt,l(((x=(b=C(n))==null?void 0:b.masterData)==null?void 0:x.currency_symbol)+Y.value),1),f(" – "+l(t.$t("that’s mean"))+" ",1),e("span",ht,l(le.value)+"%",1),f(" "+l(t.$t("off"))+"! ",1)])])):W("",!0)])):(r(),i("ul",vt,[e("li",ft,l(t.$t("Please select at least one course to proceed with payment"))+".",1)]))])])]),e("div",gt,[e("div",_t,[e("div",yt,[e("div",wt,[e("div",bt,[e("h5",kt,l(t.$t("Payment Method")),1),e("small",xt,[s[4]||(s[4]=e("i",{class:"ri-shield-check-fill me-1"},null,-1)),f(" "+l(t.$t("100% Secure Payment")),1)])]),e("div",$t,[e("div",Ct,[(r(!0),i(T,null,D(($=(E=C(n))==null?void 0:E.masterData)==null?void 0:$.payment_methods,o=>(r(),i("div",{key:o.id,class:"col"},[e("div",{onClick:q=>y.value=o.gateway,class:Z(["card","payment-card","d-flex","flex-row","justify-content-between","align-items-center","px-2 py-1",y.value==o.gateway?"selected":""])},[e("img",{src:o.logo,class:"payment-logo",alt:"Payment method logo"},null,8,Tt),e("input",{class:"form-check-input",type:"radio",checked:y.value==o.gateway},null,8,Dt)],10,Pt)]))),128))])])]),e("div",Bt,[e("input",{type:"checkbox",class:"form-check-input",id:"exampleCheck1",required:"",onChange:s[2]||(s[2]=o=>fe(S)?S.value=!0:S=!0)},null,32),e("label",jt,[f(l(t.$t("By proceeding, you agree to the"))+" ",1),z(a,{to:"/page/terms_and_conditions",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:H(()=>[f(l(t.$t("Terms & Condition")),1)]),_:1}),s[5]||(s[5]=f(",",-1)),z(a,{to:"/page/privacy_policy",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:H(()=>[f(l(t.$t("Privacy Policy")),1)]),_:1}),f(" "+l(t.$t("and"))+" ",1),z(a,{to:"/page/refund_policy",class:"text-decoration-none bg-transparent border-0 text-primary"},{default:H(()=>[f(l(t.$t("Refund Policy")),1)]),_:1}),f(" of "+l((G=(I=C(n))==null?void 0:I.masterData)==null?void 0:G.name),1)])]),e("div",It,[e("button",{onClick:oe,class:"btn btn-primary rounded-pill fw-bold w-100"},[f(l(t.$t("Pay"))+" "+l((K=(J=C(n))==null?void 0:J.masterData)==null?void 0:K.currency_symbol)+l((Q=h.value)==null?void 0:Q.price)+" ",1),s[6]||(s[6]=e("i",{class:"bi bi-arrow-right float-end"},null,-1))])])])])])])])]))}}},Ot=ee(St,[["__scopeId","data-v-98058185"]]);export{Ot as default};
